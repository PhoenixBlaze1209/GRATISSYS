<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>View Logs - Gratis Attendance</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .student-card {
      transition: all 0.25s ease;
    }

    /* Smooth modal animation */
    .modal-enter {
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.3s ease;
    }
    .modal-enter-active {
      opacity: 1;
      transform: translateY(0);
    }
  </style>

  <script>
    // ğŸ” Search Filter
    function filterStudents() {
      let input = document.getElementById("studentSearch").value.toLowerCase();
      let cards = document.querySelectorAll(".student-card");

      cards.forEach(card => {
        let text = card.innerText.toLowerCase();
        card.style.display = text.includes(input) ? "flex" : "none"; // âœ… Keeps layout
      });
    }

    // ğŸ“‹ Modal Functions
    function openModal(studentId) {
      fetch(`/view-logs-modal/${studentId}`)
        .then(response => response.text())
        .then(html => {
          const modal = document.getElementById("logModal");
          const content = document.getElementById("modalContent");

          content.innerHTML = html;
          modal.classList.remove("hidden");

          // Add fade-in animation
          content.classList.add("modal-enter");
          setTimeout(() => content.classList.add("modal-enter-active"), 10);
        })
        .catch(err => console.error("Error loading logs:", err));
    }

    function closeModal() {
      const modal = document.getElementById("logModal");
      const content = document.getElementById("modalContent");

      content.classList.remove("modal-enter-active");
      setTimeout(() => {
        modal.classList.add("hidden");
        content.innerHTML = "";
      }, 200);
    }

    // ğŸ•’ Auto-hide flash messages
    setTimeout(() => {
      const flashes = document.querySelectorAll('.flash');
      flashes.forEach(el => {
        el.classList.add('opacity-0', 'translate-y-2');
        setTimeout(() => el.remove(), 500);
      });
    }, 3000);
  </script>
</head>

<body class="flex bg-gray-100 min-h-screen">
  <!-- ğŸ”” Flash Notification -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div id="flash-container" class="fixed top-5 right-5 space-y-3 z-50">
        {% for category, message in messages %}
          <div class="flash p-3 rounded-lg shadow-lg text-white text-sm font-medium transition duration-500 transform"
               {% if category == 'success' %} style="background-color: #22c55e" 
               {% elif category == 'error' %} style="background-color: #ef4444"
               {% else %} style="background-color: #6b7280" {% endif %}>
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Sidebar -->
  <aside class="w-64 bg-gradient-to-b from-red-600 to-rose-600 text-white flex flex-col p-6 fixed h-screen">
    <h2 class="text-2xl font-extrabold mb-8">Gratis Admin</h2>
    <nav class="flex flex-col space-y-4">
      <a href="{{ url_for('admin_dashboard') }}" class="hover:bg-white/20 px-4 py-2 rounded-lg transition">ğŸ“Š Dashboard</a>
      <a href="{{ url_for('view_pending') }}" class="hover:bg-white/20 px-4 py-2 rounded-lg transition">ğŸ“ Pending Registration</a>
      <a href="{{ url_for('view_logs') }}" class="hover:bg-white/20 px-4 py-2 rounded-lg transition">ğŸ“‘ View Logs</a>
      <a href="{{ url_for('view_status_history') }}" class="hover:bg-white/20 px-4 py-2 rounded-lg transition">ğŸ“œ Status History</a>
      <a href="{{ url_for('logoutA') }}" class="mt-auto bg-white text-red-600 font-semibold px-4 py-2 rounded-lg shadow hover:bg-gray-100 transition">ğŸšª Logout</a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="ml-64 p-8 flex-1">
    <!-- Title -->
    <h1 class="text-3xl font-bold text-gray-800 mb-6">View & Print Student Logs</h1>

    <!-- Student List Section -->
    <div class="bg-white rounded-xl shadow p-6 mb-8">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold text-gray-700">Select a Student</h2>
        <input type="text" id="studentSearch" onkeyup="filterStudents()" placeholder="Search student..."
               class="border border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-red-400 outline-none w-64" />
      </div>

      <div id="studentGrid">
        {% for s in students %}
        <div 
          class="student-card p-4 mb-2 border rounded-lg shadow-sm hover:shadow-md transition bg-gray-50 flex justify-between items-center">
          <div>
            <p class="font-semibold text-gray-800">{{ s.full_name }}</p>
            <p class="text-sm text-gray-600">({{ s.student_number }})</p>
          </div>
          <button 
            onclick="openModal('{{ s.id }}')" 
            class="px-3 py-1 bg-red-500 text-white rounded-md hover:bg-red-600 transition">
            View Logs
          </button>
        </div>
        {% endfor %}
      </div>
    </div>
  </main>

  <!-- Modal -->
  <div id="logModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-xl shadow-lg w-11/12 md:w-3/4 lg:w-1/2 p-6 relative">
      <button onclick="closeModal()" class="absolute top-3 right-3 text-gray-600 hover:text-red-500 text-xl font-bold">&times;</button>
      <div id="modalContent" class="overflow-y-auto max-h-[70vh]"></div>
    </div>
  </div>
</body>
</html>
